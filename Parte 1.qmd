---
title: "Banco de dados: Boston House Prices"
author: "Fernado Bispo, Jeff Caponero"
format:
    pdf:
      toc: true
      toc-title: Sumário
      colorlinks: true
      documentclass: report
      papersize: letter
      number-sections: false
      geometry:
        - top=30mm
        - left=30mm
        - right=20mm
        - bottom=20mm
        - heightrounded
      fig-pos: "H"
      fig-align: center
      lang: pt-BR
      fontfamily: libertinus
      fontsize: 12pt
      include-in-header:
      - text: |
          \usepackage{caption}
          \usepackage{fontspec}
          \usepackage{xcolor}
          \usepackage{indentfirst}
          \captionsetup[table]{name=Tabela}
---

```{r pacotes&dados}
#| echo: false
#| warning: false


# PACOTES ----

if (!require(pacman))
  install.packages("pacman")
library(pacman)

pacman::p_load(tidyverse,  janitor, stargazer,  sjmisc, summarytools,
               kableExtra, moments, ggpubr, formattable, gridExtra, 
               glue, corrplot, sessioninfo, readxl, writexl, ggthemes,
               patchwork,  plotly, lmtest, olsrr, gglm, ggplot2,
               tidymodels, GGally, skimr)

dados <- read.csv("boston.csv")

## Arrumação ----
dados <- dados|>
  janitor::clean_names()

dados <- dados|>
  mutate(
    chas = forcats::as_factor(chas),
    rad = forcats::as_factor(rad))
``` 

<!-- ## Sobre o banco de dados -->

<!-- ### Contexto -->

<!-- Os dados de preços de 506 casas em Boston publicados em HHarrison, D. and Rubinfeld, D.L. 'Hedonic prices and the demand for clean air', J. Environ. Economics & Management, vol.5, 81-102, 1978.   -->
<!-- Os dados podem ser acessados em:   -->
<!-- https://www.kaggle.com/datasets/fedesoriano/the-boston-houseprice-data.   -->

<!-- ### Objetivo -->

<!-- O objetivo deste trabalho será determinar, a partir de técnicas de regressão linear, o preço de casas em Boston com base nos dados fornecidos pelo banco de dados análisado. -->

# Introdução

A busca pela moradia própria é o desejo da grande maioria das pessoas, contudo a conquista desse bem nos grandes centros não é tarefa fácil. Levando isso em consideração a procura por imóveis na região metropolitana torna-se uma opção viável economicamente, mesmo havendo penalizações no que diz respeito a distância e congestionamentos.

O objetivo deste relatório é trazer a luz as análises e conclusões acerca da utilização das técnicas de regressão linear a fim de determinar o preço das casas em Boston, baseado nos dados fornecidos pelo conjunto de dados obtido. Neste primeiro momento, em que se utilizará a regressão linear simples, se buscará determinar uma função que descreva a relação entre o Valor Médio dos imóveis e o Percentual da população de "classe baixa".

Composto por 506 observações e 14 variáveis, o conjunto de dados, publicado no *Jornal of Environmental Economics & Management*, vol.5, 81-102, 1978.t, traz inúmeras características que servirão de parâmetros para resolução do seguinte questionamento: O valor médio dos imóveis é influenciado pelas diversas características externas observadas?

# Metodologia

## Sobre o conjunto de dados

Os dados de preços de 506 casas em Boston, publicados em Harrison, D. and Rubinfeld, D.L. [*'Hedonic prices and the demand for clean air'*](https://www.researchgate.net/profile/Daniel-Rubinfeld/publication/4974606_Hedonic_housing_prices_and_the_demand_for_clean_air/links/5c38ce85458515a4c71e3a64/Hedonic-housing-prices-and-the-demand-for-clean-air.pdf), J. Environ. Economics & Management, vol.5, 81-102, 1978.

Usado em Belsley, Kuh & Welsch, [*'Regression diagnostics: identifying influential data and sources of collinearity.*](https://www.wiley.com/en-us/Regression+Diagnostics%3A+Identifying+Influential+Data+and+Sources+of+Collinearity-p-9780471691174) New York: Wiley 1980.
Os dados podem ser acessados na plataforma para aprendizado de ciência de dados [Kaggle](https://www.kaggle.com/datasets/fedesoriano/the-boston-houseprice-data) através do link:

<https://www.kaggle.com/datasets/fedesoriano/the-boston-houseprice-data>.  

### Variáveis a serem analisadas

A amostra contêm 14 atributos de casas em diferentes locais nos subúrbios de Boston no final dos anos 1970, sendo duas delas classificadas como categóricas e 12 como numéricas. O objetivo é o valor médio das casas em um local (em k$).
As variáveis presentes no banco de dados são descritas a seguir bem como a forma que estas variáveis serão representadas ao longo deste relatório a fim de facilitar o entendimento:


1. CRIM: Índice de criminalidade per capita por bairro.
Taxa de criminalidade por cidade. Uma vez que o CRIM mede a ameaça ao bem-estar que as famílias percebem em vários bairros da área metropolitana de Boston (assumindo que as taxas de criminalidade são geralmente proporcionais às percepções de perigo das pessoas), ele deve ter um efeito negativo nos valores das moradias. Será representada como **Índice Criminalidade**.

2. ZN: Proporção da área residencial de uma cidade dividida em lotes com mais de 25.000 pés quadrados. Uma vez que tal zoneamento restringe a construção de pequenas casas em lotes, esperamos que o ZS esteja positivamente relacionado aos valores das moradias. Um coeficiente positivo também pode surgir porque o zoneamento representa a exclusividade, a classe social e as comodidades externas de uma comunidade. Será representada como **Prop. Terreno Zoneado**.

3. INDUS: Proporção de hectares de negócios não varejistas por bairro. O INDUS serve como um *proxy* para as externalidades associadas ao ruído da indústria, tráfego intenso e efeitos visuais desagradáveis e, portanto, deve afetar negativamente os valores das habitações. Será representado por **Área Industrial**.

4. CHAS: Variável fictícia categórica que representa imóveis próximos a margem do rio Charles (1 se o trecho margeia o rio; 0 caso contrário). Será representada como **Margem**.

5. NOX: Concentração de óxidos nítricos em pphm (partes por 100 milhões). Será representada como **Índice Oxido Nítrico**.

6. RM: Número médio de quartos em unidades proprietárias. RM representa espaço e, em certo sentido, quantidade de habitação. Deve estar positivamente relacionado com o valor da habitação. Verificou-se que a forma RM² fornece um ajuste melhor do que as formas linear ou logarítnica. Será representada por **N° de Cômodos**.

7. AGE: Proporção de unidades próprias construídas antes de 1940. A idade da unidade geralmente está relacionada à qualidade da estrutura. Será representada por **Idade**

8. DIS: Distâncias ponderadas para cinco centros de emprego  na região de Boston. De acordo com as teorias tradicionais de gradientes de renda da terra urbana, os valores das moradias devem ser maiores perto de locatários de emprego. DIS é inserido na forma logarítmica; o sinal esperado é negativo. Será representada como **Dist. Empregos**.

9. RAD: Variável categórica que representa o índice de acessibilidade às rodovias radiais. O índice de acesso rodoviário foi calculado com base na cidade. Boas variáveis de área de estrada são necessárias para que todas as variáveis de poluição não capturem as vantagens locacionais de estradas. O RAD captura outros tipos de vantagens locacionais além da proximidade do local de trabalho. é inserido na forma logarítmica; o sinal esperado é positivo. Será representada como **Acessibilidade Rodovias**.

10. TAX: Valor total do imposto sobre a propriedade ($/$10,000). Mede o custo dos serviços públicos na comunidade terrestre. As taxas de imposto nominais foram corrigidas pelos índices de avaliação locais para gerar o valor total da taxa de imposto para cada cidade. Diferenças intramunicipais na taxa de avaliação eram difíceis de obter e, portanto, não eram usadas. O coeficiente desta variável deve ser negativo.
Será representada como **Imposto**.

11. PTRATIO: Proporção aluno-professor por distrito escolar da cidade. Mede os benefícios do setor público em cada cidade. A relação do rácio aluno-professor com a qualidade da escola não é totalmente clara, embora um rácio baixo deva significar que cada aluno recebe mais atenção individual. Esperamos o sinal em PTRATIO seja negativo. Será representada como **Prop. Prof.-Aluno**.

12. B: O resultado da equação $B=1000(Bk - 0,63)^2$ onde $Bk$ é a proporção de negros por bairro. Em níveis baixos a moderados de B, um aumento em B deve ter uma influência negativa no valor da habitação se os negros forem considerados vizinhos indesejáveis pelos brancos. No entanto, a discriminação de mercado significa que os valores das moradias são mais altos em níveis muito altos de B. Espera-se, portanto, uma relação parabólica entre a proporção de negros em um bairro e os valores das moradias. Será representada por **Prop. Negros/bairro**.

13. LSTAT: Proporção da população de "classe baixa", ou seja, com status inferior = 1/2 (proporção de adultos sem nível de ensino médio e proporção de trabalhadores do sexo masculino classificados como trabalhadores). A especificação logarítmica implica que as distinções de status socioeconômico significam mais nas camadas superiores da sociedade do que nas classes inferiores. Será representada por **Pop. Classe Baixa**.


### Variável de Saída (Resposta):
- Valor do Imóvel: Valor médio de residências ocupadas pelo proprietário em US\$1.000 [k\$].  

### Fonte

StatLib - Carnegie Mellon University


# Resultados

## Análise Descritiva

De modo a conhecer melhor o banco de dados analisado é importante realizar uma análise descritiva das variáveis que o compõem. Na Tabela 1 pode se ver as medidas de resumo de posição e de tendência central destas variáveis.

```{r}
#| echo: false
#| warning: false
#| 


# setwd("~/Dropbox/Estatística/StatisticWorks/Boston_House_Prices")
# set.seed(7)

```



```{r tab1:medidas_resumo}
#| echo: false
#| warning: false

# Medidas Resumo ----
summarytools::st_options(lang = "pt")

dados|>
  # select(-b, - rad, -zn)|>
  rename(
    "Idade do Imóvel" = age, "Índice Criminalidade" = crim, "Dist. Empregos" = dis, "Área Industrial" = indus,
    "Pop. Classe Baixa" = lstat, "Índice Oxido Nítrico" = nox, "Prop. Prof.-Aluno" = ptratio,
    "N° Cômodos" = rm, "Imposto Propriedade" = tax, "Valor do Imóvel" = medv, "Acessibilidade Rodovias" = rad, "Prop. Terreno Zoneado" = zn, "Prop. Negros/bairro" = b
  )|>
  summarytools::descr(
    stats = c("min", "q1", "med", "mean","q3", "max",  "sd", "cv", "Skewness", "Kurtosis"),
    justify = "c",
    style = "rmarkdown",
    transpose = T
  )|>
    kbl(
    caption = "Medidas Resumo dos dados",
    digits = 2,
    format.args=list(big.mark=".", decimal.mark=","),
    align = "c", row.names = T, booktabs = T
  )|>
  kable_styling(
    full_width = F, position = 'center', 
    latex_options = c("striped", "HOLD_position", "scale_down", "repeat_header")
  )|>
  column_spec(1, bold = F
              )|>
  footnote(
    general = "StatLib - Carnegie Mellon University",
    general_title = "Fonte:",
    footnote_as_chunk = T
    )|>
  kable_material()

```


Para facilitar a compreenção das medidas apresentadas na Tabela 1, a Figura 1 mostra graficamente estas distribuições.

```{r}
#| echo: false
#| warning: false
#| fig-align: center
#| fig-pos: H


# 
# g1 <- dados|>
#   ggplot() +
#     aes(x = CRIM) +
#   geom_histogram(
#     aes(y = ..density..),
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Criminalidade",
#     x = "Índice",
#     y = "Densidade"
#   )
# 
# g2 <- dados|>
#   ggplot() +
#     aes(x = ZN) +
#   geom_histogram(
#     aes(y = ..density..),
#     binwidth = 1,
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Zoneamento",
#     x = "Proporção do Terreno",
#     y = "Densidade"
#   )
# 
# g3 <- dados|>
#   ggplot() +
#     aes(x = INDUS) +
#   geom_histogram(
#     aes(y = ..density..),
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Empresas",
#     x = "Hectares Ocupados",
#     y = "Densidade"
#   )
# 
# g4 <- dados|>
#   ggplot() +
#     aes(x = CHAS) +
#   geom_histogram(
#     aes(y = ..density..),
#     binwidth = 5,
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Margem",
#     x = "Margem do Charles River",
#     y = "Densidade"
#   )
# 
# g5 <- dados|>
#   ggplot() +
#   aes(x = NOX) +
#   geom_histogram(
#     aes(y = ..density..),
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Óxidos Nitricos",
#     x = "Partes por 10 milhões",
#     y = "Densidade"
#   )
# 
# g6 <- dados|>
#   ggplot() +
#   aes(x = RM) +
#   geom_histogram(
#     aes(y = ..density..),
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Cômodos",
#     x = "Quantidade",
#     y = "Densidade"
#   )
# 
# 
# g7 <- dados|>
#   ggplot() +
#   aes(x = AGE) +
#   geom_histogram(
#     aes(y = ..density..),
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Idade",
#     x = "Proporção antes de 1940",
#     y = "Densidade"
#   )
# 
# 
# g8 <- dados|>
#   ggplot() +
#   aes(x = DIS) +
#   geom_histogram(
#     aes(y = ..density..),
#     binwidth = 5,
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Distância",
#     x = "Distâncias Ponderadas",
#     y = "Densidade"
#   )
# 
# 
# g9 <- dados|>
#   ggplot() +
#   aes(x = RAD) +
#   geom_histogram(
#     aes(y = ..density..),
#     binwidth = 5,
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Acessibilidade",
#     x = "Índice",
#     y = "Densidade"
#   )
# 
# 
# g10 <- dados|>
#   ggplot() +
#   aes(x = TAX) +
#   geom_histogram(
#     aes(y = ..density..),
#     binwidth = 5,
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Imposto",
#     x = "Valor por $10.000",
#     y = "Densidade"
#   )
# 
# 
# g11 <- dados|>
#   ggplot() +
#   aes(x = PTRATIO) +
#   geom_histogram(
#     aes(y = ..density..),
#     binwidth = 5,
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Aluno/Professor",
#     x = "Proporção",
#     y = "Densidade"
#   )
# 
# 
# g12 <- dados|>
#   ggplot() +
#   aes(x = B) +
#   geom_histogram(
#     aes(y = ..density..),
#     binwidth = 5,
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Negros",
#     x = "Proporção",
#     y = "Densidade"
#   )
# 
# 
# g13 <- dados|>
#   ggplot() +
#   aes(x = LSTAT) +
#   geom_histogram(
#     aes(y = ..density..),
#     binwidth = 5,
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Classe",
#     x = '% de \"Classe Baixa\"',
#     y = "Densidade"
#   )
# 
# 
# g14 <- dados|>
#   ggplot() +
#   aes(x = MEDV) +
#   geom_histogram(
#     aes(y = ..density..),
#     binwidth = 5,
#     fill = "lightblue",
#     colour = "darkblue") +
#   geom_density(
#     alpha = 0.2,
#     fill = "blue",
#     colour = "blue") +
#   labs(
#     title = "Valor",
#     x = "Valor Médio",
#     y = "Densidade"
#   )
# 
# (g1+g2)/(g3+g4) + plot_annotation(
#   title = "Figura 1: Histogramas das variáveis em análise.") &
#   theme_bw(base_size = 8) &
#   theme(
#     plot.tag.position = c(0, 1),
#     plot.tag = element_text(size = 8, hjust = 0, vjust = 0)
#   )
# 
# (g5+g6)/(g7+g8) + plot_annotation() & 
#   theme_bw(base_size = 8) &
#   theme(
#     plot.tag.position = c(0, 1),
#     plot.tag = element_text(size = 8, hjust = 0, vjust = 0)
#   )
# 
# (g9+g10)/(g11+g12) + plot_annotation() & 
#   theme_bw(base_size = 8) &
#   theme(
#     plot.tag.position = c(0, 1),
#     plot.tag = element_text(size = 8, hjust = 0, vjust = 0)
#   )
# 
# 
# (g13+g14)/(plot_spacer() + plot_spacer()) +
#   theme_bw(base_size = 8) &
#   theme(
#     legend.position = "none",
#     plot.tag.position = c(0, 1),
#     plot.tag = element_text(size = 8, hjust = 0, vjust = 0)
#   )
```

```{r fig1:Histograma}
#| echo: false
#| warning: false
#| fig-height: 9
#| fig-width: 7

# Histograma ----
{
## g1 age ----
g1 <- dados|>
  ggplot() +
  aes(x = age) +
  geom_histogram(
    aes(y = ..density..),
    bins = 40,
    fill = "lightblue",
    colour = "darkblue") +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = "Unidades constuídas antes \nde 1940",
    x = "Proporção",
    y = "Densidade"
  )

## g2 crim ----
g2 <- dados|>
  ggplot() +
  aes(x = crim) +
  geom_histogram(
    aes(y = ..density..),
    fill = "lightblue",
    colour = "darkblue",
    # binwidth = 2
    bins = 45
    ) +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = "Índice de Criminalidade",
    x = "Índice",
    y = "Densidade"
  )

## g3 dis ----
g3 <- dados|>
  ggplot() +
  aes(x = dis) +
  geom_histogram(
    aes(y = ..density..),
    bins = 45,
    fill = "lightblue",
    colour = "darkblue") +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_x_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = "Distância para cinco centros \nde emprego.",
    x = "Distâncias Ponderadas",
    y = "Densidade"
  )

## g4 indus ----
g4 <- dados|>
  ggplot() +
  aes(x = indus) +
  geom_histogram(
    aes(y = ..density..),
    bins = 40,
    fill = "lightblue",
    colour = "darkblue") +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = "Negócios não varejistas \npor bairro",
    x = "Proporção de hectares ocupados",
    y = "Densidade"
  )

## g5 lstat ----
g5 <- dados|>
  ggplot() +
  aes(x = lstat) +
  geom_histogram(
    aes(y = ..density..),
    bins = 40,
    fill = "lightblue",
    colour = "darkblue") +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = 'População de "classe baixa"',
    x = 'Percentual',
    y = "Densidade"
  )

## g6 medv ----
g6 <- dados|>
  ggplot() +
  aes(x = medv) +
  geom_histogram(
    aes(y = ..density..),
    bins = 35,
    fill = "lightblue",
    colour = "darkblue") +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = "Valor médio de residências \nocupadas",
    x = "Valor Médio",
    y = "Densidade"
  )
## g7 nox ----
g7 <- dados|>
  ggplot() +
  aes(x = nox) +
  geom_histogram(
    aes(y = ..density..),
    fill = "lightblue",
    colour = "darkblue") +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = "Concentração de Óxidos \nNitricos (NO)",
    x = "Partes por 10 milhões",
    y = "Densidade"
  )

## g8 ptratio ----
g8 <- dados|>
  ggplot() +
  aes(x = ptratio) +
  geom_histogram(
    aes(y = ..density..),
    bins = 30,
    fill = "lightblue",
    colour = "darkblue") +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_x_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = "Aluno/Professor por bairro",
    x = "Proporção",
    y = "Densidade"
  )

## g9 rm ----
g9 <- dados|>
  ggplot() +
  aes(x = rm) +
  geom_histogram(
    aes(y = ..density..),
    fill = "lightblue",
    colour = "darkblue") +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = "Número médio de cômodos por \nhabitação",
    x = "Quantidade",
    y = "Densidade"
  )

## g10 tax ----
g10 <- dados|>
  ggplot() +
  aes(x = tax) +
  geom_histogram(
    aes(y = ..density..),
    bins = 35,
    fill = "lightblue",
    colour = "darkblue") +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = "Taxa de imposto predial",
    x = "Valor por $10.000",
    y = "Densidade"
  )

## g11 zn ----
g11 <- dados|>
  ggplot() +
  aes(x = zn) +
  geom_histogram(
    aes(y = ..density..),
    bins = 35,
    fill = "lightblue",
    colour = "darkblue") +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = "Proporção de Terreno Zoneado",
    x = "Proporção de Terreno",
    y = "Densidade"
  )

## g12 b ----
g12 <- dados|>
  ggplot() +
  aes(x = b) +
  geom_histogram(
    aes(y = ..density..),
    bins = 35,
    fill = "lightblue",
    colour = "darkblue") +
  geom_density(
    alpha = 0.2,
    fill = "blue",
    colour = "blue") +
  scale_y_continuous(
    labels = scales::number_format(
      big.mark = ".",
      decimal.mark = ","
    )) +
  labs(
    title = "Proporção de Negros por bairro",
    x = "Proporção",
    y = "Densidade"
  )

g1 + g2 + g3 + g4 + g5 + g6 + g7 + g8 + g9 + g10 + g11 + g12 + 
  plot_layout(ncol = 3) + 
  plot_annotation(
    title = "Figura 1: Histogramas das variáveis em análise.",
    caption = "Fonte: StatLib - Carnegie Mellon University",
    tag_levels = c("A", "1"), tag_prefix = "Sub Fig. ", tag_sep = ".",
    tag_suffix = ":") &
  theme_minimal(base_size = 7.5) &
  theme(
    plot.tag.position = c(0, 1),
    plot.tag = element_text(size = 5.5, hjust = 0, vjust = -0.4))
}
```


Desta análise inicial, destancam-se algumas características:

1. O Índice de criminalidade per capita por bairro é bastante baixo na maioria dos bairros;
2. A Proporção de terreno residencial zoneada para lotes acima de 25.000 sq.ft. contém uma alta concentração de valores zeros;
3. Verifica-se uma concentração de empresas com cerca de 18 hectares em diversos bairros;
4. Há uma concentração de imóveis com alto valor total do imposto predial;
5. A maior parte dos bairros tinha alta proporção de negros. 


```{r fig2:Grafico_Barras}
#| echo: false
#| warning: false
#| fig-height: 9
#| fig-width: 7

p1 <- dados|>
  ggplot(aes(x = rad, y = after_stat(count)/sum(after_stat(count))))+
  geom_bar(fill = "darkblue")+ 
  geom_text(
    aes(
      label = scales::percent((after_stat(count))/sum(after_stat(count))),
      y = after_stat(count)/sum(after_stat(count))),
    stat = "count", vjust = -0.2, size = 3
  ) +
  labs(
    title = "Índice de Acessibilidade às Rodovias",
    x = "Índice",
    y = "Frequência"
  )+
  scale_y_continuous(labels = scales::percent)+
  theme_minimal()+
    theme(
    legend.position = "none", title = element_text(size = 7.5))

p2 <- dados %>% 
  count(chas) %>%
  mutate(
    tipo = case_when(
      chas == "0" ~ "Não Margeiam o rio",
      chas == "1" ~ "Margeiam o rio"),
    pct = round(prop.table(n)*100, 2), 
    rotulo = glue::glue('{tipo}\n{n} ({pct}%)')) %>% 
  ggpubr::ggdonutchart(., "pct", 
                       label = "rotulo", lab.pos = "out",
                       lab.font = c(4, "plain", "black"),
                       fill = "chas",  color = "white",
                       palette = c("#FC4E07", "#00AFBB"))+
  labs(
    title = "Imóveis que margeiam o Rio Charles"
  )+
  theme(
    legend.position = "none", title = element_text(size = 7.5)
  )

p1 + p2 +
  plot_annotation(
    title = "Figura 2: Distribuição de Frequência das Variáveis Categóricas.",
    caption = "Fonte: StatLib - Carnegie Mellon University",
    tag_levels = c("A", "1"), tag_prefix = "Sub Fig. ", tag_sep = ".",
    tag_suffix = ":") &
  # theme_minimal(base_size = 7.5) &
  theme(
    plot.tag.position = c(0, 1),
    plot.tag = element_text(size = 5.5, hjust = 0, vjust = -0.4))

```



## Análise de Dados Atípicos

Com base na variável que indica se o imóvel margeia ou não o Charles River, pode-se realizar a análise de disperção dos dados por meio de gráficos do tipo BoxPlot, como se vê na Figura 1.

```{r fig2:BoxPlot}
#| echo: false
#| warning: false
#| fig-height: 9
#| fig-width: 7


# BoxPlot ----
{
## b1 age ----
b1 <- dados|>
  mutate(chas = lvls_revalue(chas, c("Na Margem", "Afastado")))|>
  ggplot(aes(x = chas, y = age)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = "Unidades constuídas antes \nde 1940",
    x = "Posição",
    y = "Proporção antes de 1940"
  )

## b2 crim ----
b2 <- dados|>
  mutate(
    chas = lvls_revalue(chas, c("Na Margem", "Afastado"))
  )|>
  ggplot(aes(x = chas, y = crim)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = "Índice de Criminalidade",
    x = "Posição",
    y = "Índice"
  )

## b3 dis ----
b3 <- dados|>
  mutate( chas = lvls_revalue(chas, c("Na Margem", "Afastado")))|>
  ggplot(aes(x = chas, y = dis)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = "Distância para cinco centros \nde emprego.",
    x = "Posição",
    y = "Distâncias Ponderadas"
  ) +
  scale_y_continuous(
    labels = scales::number_format(
      dig.mark = ".",
      decimal.mark = ","))
      
## b4 indus ----
b4 <- dados|>
  mutate(chas = lvls_revalue(chas, c("Na Margem", "Afastado")))|>
  ggplot(aes(x = chas, y = indus)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = "Negócios não varejistas \npor bairro",
    x = "Proporção de hectares ocupados",
    y = "Densidade"
  )

## b5 lstat ----
b5 <- dados|>
  mutate(chas = lvls_revalue(chas, c("Na Margem", "Afastado")))|>
  ggplot(aes(x = chas, y = lstat)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = 'População de "classe baixa"',
    x = "Posição",
    y = "Percentual"
  )

## b6 medv ----
b6 <- dados|>
  mutate(chas = lvls_revalue(chas, c("Na Margem", "Afastado")))|>
  ggplot(aes(x = chas, y = medv)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = "Valor médio de residências \nocupadas",
    x = "Posição",
    y = "Valor médio"
  )

## b7 nox ----
b7 <- dados|>
  mutate(chas = lvls_revalue(chas, c("Na Margem", "Afastado")))|>
  ggplot(aes(x = chas, y = nox)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = "Concentração de Óxidos \nNitricos (NO)",
    x = "Posição",
    y = "Partes por 10 milhões"
  ) +
  scale_y_continuous(
    labels = scales::number_format(
      dig.mark = ".",
      decimal.mark = ","))

## b8 ptratio ----
b8 <- dados|>
  mutate(chas = lvls_revalue(chas, c("Na Margem", "Afastado")))|>
  ggplot(aes(x = chas, y = ptratio)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = "Aluno/Professor por bairro",
    x = "Posição",
    y = "Proporção"
  ) +
  scale_y_continuous(
    labels = scales::number_format(
      dig.mark = ".",
      decimal.mark = ","))

## b9 rm ----
b9 <- dados|>
  mutate(chas = lvls_revalue(chas, c("Na Margem", "Afastado")))|>
  ggplot(aes(x = chas, y = rm)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = "Número médio de cômodos por \nhabitação",
    x = "Posição",
    y = "Quantidade"
  )

## b10 tax ---- 
b10 <- dados|>
  mutate(chas = lvls_revalue(chas, c("Na Margem", "Afastado")))|>
  ggplot(aes(x = chas, y = tax)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = "Taxa de imposto predial",
    x = "Posição",
    y = "Valor por $10.000"
  )

## b11 zn ---- 
b11 <- dados|>
  mutate(chas = lvls_revalue(chas, c("Na Margem", "Afastado")))|>
  ggplot(aes(x = chas, y = zn)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = "Proporção de Terreno Zoneado",
    x = "Proporção de Terreno",
    y = "Densidade"
  )

## b12 b ---- 
b12 <- dados|>
  mutate(chas = lvls_revalue(chas, c("Na Margem", "Afastado")))|>
  ggplot(aes(x = chas, y = b)) +
  geom_boxplot(col="darkblue", fill="skyblue", alpha = 0.5)+
  labs(
    title = "Proporção de Negros por bairro",
    x = "Proporção",
    y = "Densidade"
  )

b1 + b2 + b3 + b4 + b5 + b6 + b7 + b8 + b9 + b10 + b11 + b12 +  
  plot_layout(ncol = 3) + 
  plot_annotation(
    title = "Figura 3: BoxPlot das variáveis em análise.",
    caption = "Fonte: StatLib - Carnegie Mellon University",
    # theme = theme_minimal(plot.title = element_text(size = 10)),
    tag_levels = c("A", "1"), tag_prefix = "Sub Fig. ", tag_sep = ".",
    tag_suffix = ":") &
  theme_minimal(base_size = 7.5) &
  theme(
    plot.tag.position = c(0, 1),
    plot.tag = element_text(size = 5.5, hjust = 0, vjust = -0.4))
}

```
